

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Skeletons &#8212; SWDB 2024 Data Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'anatomy/microns-em/em-skeletons';</script>
    <link rel="canonical" href="https://allenswdb.github.io/anatomy/microns-em/em-skeletons.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Meshes" href="em-meshes.html" />
    <link rel="prev" title="Imagery and Segmentation" href="em-volume-data.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/cropped-SummerWorkshop_Header.png" class="logo__image only-light" alt="SWDB 2024 Data Book - Home"/>
    <script>document.write(`<img src="../../_static/cropped-SummerWorkshop_Header.png" class="logo__image only-dark" alt="SWDB 2024 Data Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Data Book for Summer Workshop on the Dynamic Brain
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Experimental Data</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../background/background.html">Background</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../background/Mouse-visual-system.html">Mouse visual system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../background/transgenic-tools.html">Transgenic tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../background/experimental-setup.html">Behavioral apparatus</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../background/Neuropixels-electrophysiology.html">Extracellular electrophysiology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../background/neuropixels-description.html">Neuropixels Probes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../physiology/ephys/visual-coding/vcnp-quality-metrics.html">Unit Quality Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../background/Optotagging.html">Optotagging</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../background/Two-photon-calcium-imaging.html">Calcium imaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../background/Ophys-ephys-comparison.html">Ophys ephys comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../background/em-connectomics.html">EM Connectomics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../background/CCF.html">Common Coordinate Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../background/metadata.html">Metadata</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../physiology/physiology.html">Physiology &amp; Behavior</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../physiology/ophys/ophys-overview.html">Optical Physiology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../physiology/ophys/visual-coding/vc2p-background.html">Visual Coding — 2-photon</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/visual-coding/vc2p-dataset.html">Dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/visual-coding/vc2p-session-data.html">Getting data from a session</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/visual-coding/vc2p-stimuli.html">Visual stimuli</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/visual-coding/vc2p-evoked-response.html">Exercise: Evoked response</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/visual-coding/vc2p-cross-session-data.html">Cross session data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/visual-coding/vc2p-analysis.html">Analysis files and cell specimens table</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../physiology/ophys/visual-behavior/VB-Ophys.html">Visual Behavior Ophys</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/visual-behavior/VBO-Dataset.html">Visual Behavior Ophys Dataset</a></li>





<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/visual-behavior/VB-BehaviorSessionData.html">Behavior Session Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/visual-behavior/VBO-ExperimentData.html">Visual Behavior Ophys Experiment Data</a></li>

<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/visual-behavior/VBO-Tutorial-Compare_trial_types.html">Tutorial Comparing Trial Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/visual-behavior/VBO-Tutorial-Downloading_data_and_exploring_the_manifest.html">Tutorial Downloading Data</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../physiology/ophys/V1DD/V1DD-overview.html">V1 Deep Dive</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/V1DD/V1DD-dataset.html">V1DD Dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/V1DD/V1DD-session-data.html">Accessing V1DD data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/V1DD/V1DD-stimuli.html">Visual stimuli</a></li>

</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../physiology/ophys/BCI/BCI-overview.html">Brain Computer Interface</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/BCI/BCI-dataset.html">Accessing BCI Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ophys/BCI/BCI-stimuli.html">BCI Stimuli</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../physiology/ephys/ephys-overview.html">Electrophysiology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../physiology/ephys/visual-coding/vcnp.html">Visual Coding — Neuropixels</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-coding/vcnp-quickstart.html">Quick start guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-coding/vcnp-data-access.html">Accessing Neuropixels Visual Coding Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-coding/vcnp-units.html">Units</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-coding/vcnp-receptive-fields.html">Receptive fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-coding/vcnp-lfp.html">Local field potential (LFP)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-coding/vcnp-optotagging.html">Optotagging Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-coding/vcnp-session.html">Full example of accessing Visual Coding Neuropixels data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-coding/vcnp-stimulus.html">Visual Stimuli</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-coding/vcnp-cheatsheet.html">Cheat sheet for visual coding Neuropixels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-coding/vcnp-links.html">Other resources</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../physiology/ephys/visual-behavior/VB-Neuropixels.html">Visual Behavior Neuropixels</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-behavior/VBN-Dataset.html">Visual Behavior Neuropixels Dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-behavior/VBN-SessionData.html">Visual Behavior Neuropixels Session</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-behavior/VBN-Tutorial-Aligning_Neural_Data_to_Stimuli.html">Tutorial Aligning Neural Data to Stimuli</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-behavior/VBN-Tutorial-Aligning_Behavior_Data_to_Task_Events.html">Tutorial Aligning Behavioral Data to Task Events</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/visual-behavior/VBN-Tutorial-Analyzing_LFP_Data.html">Tutorial Analyzing LFP data</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../physiology/ephys/cell-type-lookup-table/ctlut-background.html">Cell Type Look-up Table</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/cell-type-lookup-table/ctlut-session-data.html">Session data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/cell-type-lookup-table/ctlut-optotagging.html">Optotagging</a></li>





<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/cell-type-lookup-table/ctlut-accessing-data.html">Accessing cell type lookup table data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/cell-type-lookup-table/ctlut-identifying-tagged-units.html">Identifying tagged neurons</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../physiology/ephys/np-ultra/npultra-psychedelics.html">Neuropixels Ultra &amp; Psychedelics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/np-ultra/npultra-psychedelics-stimuli.html">NP Ultra &amp; Psychedelics Stimuli and Optotagging protocol</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../physiology/ephys/np-ultra/npultra-psychedelics-accessing-data.html">Accessing NP Ultra &amp; Psychedelics Data</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../physiology/stimuli/stimuli.html">Stimuli and Behavioral Tasks</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../physiology/stimuli/passive-visual-stimuli/visual-stimuli-list.html">Visual Stimuli</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../physiology/stimuli/visual-behavior/VB-Behavior.html">Visual Behavior Task</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../physiology/stimuli/dynamic-foraging/Dynamic-Foraging.html">Dynamic Foraging</a></li>

</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../anatomy.html">Anatomy</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="em-background.html">Electron Microscopy</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="em-structural-data.html">Dataset Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="proofreading.html">Proofreading and Data Quality</a></li>
<li class="toctree-l3"><a class="reference internal" href="em-neuroglancer.html">Neuroglancer</a></li>
<li class="toctree-l3"><a class="reference internal" href="em-dash-apps.html">Dash Apps</a></li>
<li class="toctree-l3"><a class="reference internal" href="em-caveclient-setup.html">Setting up CAVEclient</a></li>
<li class="toctree-l3"><a class="reference internal" href="em-querying-tables.html">Programmatic Access</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="em-coordinates.html">Coordinate Systems</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="key-tables.html">CAVE Annotation Tables</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="em-microns-tables.html">MICrONS Key Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="em-v1dd-tables.html">V1DD Key Tables</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="em-volume-data.html">Imagery and Segmentation</a></li>


<li class="toctree-l2 current active"><a class="current reference internal" href="#">Skeletons</a></li>
<li class="toctree-l2"><a class="reference internal" href="em-meshes.html">Meshes</a></li>
<li class="toctree-l2"><a class="reference internal" href="em-functional_data.html">MICrONS Functional Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="em-functional-v1dd.html">V1DD Functional Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="em-ultrastructure.html">Ultrastructure Resources</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../single-cell-morphology/scm-background.html">Single Cell Morphology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../single-cell-morphology/scm-imageprocessing.html">ExaSPIM Image Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../single-cell-morphology/scm-data.html">Single Cell Morphology Data Access</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Computational Tools</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../computational/data-analysis/data-analysis.html">Data Analysis Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../computational/data-analysis/PCA.html">Principal Component Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computational/data-analysis/regression.html">Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computational/data-analysis/GLM.html">Generalized Linear Model (GLM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../computational/data-analysis/classification.html">Classification Tutorial</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../practicalities/practicalities.html">Practicalities</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../practicalities/github-code-ocean.html">Creating a Code Ocean capsule synced to GitHub repo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../practicalities/code-ocean-collab.html">Collaborating using Code Ocean</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../practicalities/code-ocean-vs-code.html">Using VS Code in Code Ocean</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../practicalities/allensdk-pyNWB.html">Allen SDK and pyNWB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../practicalities/pyNWB.html">Using Python to Access Neurodata Without Borders-type Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../practicalities/git.html">Git</a></li>

</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../bibliography.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributors.html">Contributors and Credits</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/allenswdb/allenswdb.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/allenswdb/allenswdb.github.io/edit/main/databook/anatomy/microns-em/em-skeletons.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/allenswdb/allenswdb.github.io/issues/new?title=Issue%20on%20page%20%2Fanatomy/microns-em/em-skeletons.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/anatomy/microns-em/em-skeletons.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Skeletons</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-specificity">Dataset specificity</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-precomputed-skeleton">What is a Precomputed skeleton?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#caveclient-to-download-skeletons">CAVEclient to download skeletons</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-dictionary-to-meshwork-skeleton">convert dictionary to meshwork skeleton</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-with-skeleton-plot">Plot with skeleton_plot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-meshwork-objects">Working with Meshwork Objects</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#skeleton-properties-and-methods">Skeleton Properties and Methods</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#vertices-and-neighborhoods">Vertices and Neighborhoods</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#paths-and-segments">Paths and Segments</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#masking">Masking</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-em-skeletons-are-generated">How EM skeletons are generated</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="skeletons">
<span id="id1"></span><h1>Skeletons<a class="headerlink" href="#skeletons" title="Permalink to this heading">#</a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Before using any programmatic access to the data, <a class="reference internal" href="em-caveclient-setup.html#em-content-cave-setup"><span class="std std-ref">you first need to set up your CAVEclient token</span></a>.</p>
</div>
<p>Often in working with neurons, you want to measure things along a linear dimension of a neuron. Length of axon, for example. Or number of branches. However, the EM segmentation is a complex 3d shape that makes this non-trivial.</p>
<figure class="align-center" id="id2">
<img alt="../../_images/segmentation_mesh_skeleton_representation.png" src="../../_images/segmentation_mesh_skeleton_representation.png" />
<figcaption>
<p><span class="caption-number">Fig. 38 </span><span class="caption-text">Electron microscopy data can be represented and rendered in multiple formats, at different levels of abstraction from the original imagery</span><a class="headerlink" href="#id2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>There are methods for reducing the shape of a segmented neuron down to a linear tree-like structure usually referred to as a <strong>skeleton</strong>. We have precalculated skeletons for a large number of cells in the MICrONS dataset, including the proofread cells with the most complete axons.</p>
<p>There are several <strong>formats</strong> of EM skeleton that you may encounter in this workshop and tutorial material. See the subsections below for more about them. As a summary:</p>
<ul class="simple">
<li><p>swc skeleton : files end in .swc</p></li>
<li><p>meshwork skeleton : objects saved in h5 file format</p></li>
<li><p>precomputed skeleton : a binary file for each skeleton, within a directory with metadata ‘info’ files on how to render them</p></li>
</ul>
<p><strong>All of these formats are composed of a set of vertices and edges which form the graph of the neuron’s branching structure.</strong> As well as information about the <strong>compartment type</strong> of the vertex, indicating if it is axon, dendrite, soma etc. And the <strong>radius</strong> of the branch, measured as half the cable thickness in micrometers.</p>
<p>However, the different formats may have different metadata attached to each vertex. <strong>Meshwork</strong> skeleton objects may include annotations about the input and output synapses, and provide functions to operate on the graph of the skeleton. <strong>Precomputed</strong> format may include arbitrary <strong>vertex properties</strong> that summarize connectivity information (for EM neurons) and CCF brain area (for exaSPIM neurons; see the section on Single Cell Morphology for more)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Any format of skeleton can be converted into a <strong>Meshwork skeleton object</strong> to make use of the graph functions.</p>
</div>
<section id="dataset-specificity">
<h2>Dataset specificity<a class="headerlink" href="#dataset-specificity" title="Permalink to this heading">#</a></h2>
<p>The examples below are written with the MICrONS dataset. To access the V1DD dataset change the datastack from <code class="docutils literal notranslate"><span class="pre">minnie65_public</span></code> to <code class="docutils literal notranslate"><span class="pre">v1dd_public</span></code></p>
</section>
<section id="what-is-a-precomputed-skeleton">
<h2>What is a Precomputed skeleton?<a class="headerlink" href="#what-is-a-precomputed-skeleton" title="Permalink to this heading">#</a></h2>
<p>These skeletons are stored in the cloud as a bytes-IO object, which can be viewed in <strong>Neuroglancer</strong>, or downloaded with <strong>CAVEclient.skeleton</strong> module. These precomputed skeletons also contain annotations on the skeletons that have the synapses, which skeleton nodes are axon and which are dendrite, and which are likely the apical dendrite of excitatory neurons.</p>
<figure class="align-default" id="id3">
<img alt="../../_images/skeleton-cartoon.png" src="../../_images/skeleton-cartoon.png" />
<figcaption>
<p><span class="caption-number">Fig. 39 </span><span class="caption-text">Cartoon illustration of “level 2” graph and skeletons.</span><a class="headerlink" href="#id3" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The precomputed format is flexible and scalable, applies for EM data and light microscopy data, and can be rendered in <a class="reference external" href="https://spelunker.cave-explorer.org/#!middleauth+https://global.daf-apis.com/nglstate/api/v1/4754960374824960">Neuroglancer</a>.</p>
<p>For more on how skeletons are generated from the mesh objects see the section below, and for additional tools for generating, cacheing, and downloading meshes, <a class="reference external" href="https://caveconnectome.github.io/CAVEclient/tutorials/skeletonization/">see the Skeleton Service documentation</a></p>
</section>
<section id="caveclient-to-download-skeletons">
<h2>CAVEclient to download skeletons<a class="headerlink" href="#caveclient-to-download-skeletons" title="Permalink to this heading">#</a></h2>
<p>Retrieve a skeleton using <code class="docutils literal notranslate"><span class="pre">get_skeleton()</span></code>. The available output_formats (described below) are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dict</span></code> containing vertices, edges, radius, compartment, and various metadata (default if unspecified)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">swc</span></code> a Pandas Dataframe in the SWC format, with ordered vertices, edges, compartment labels, and radius.</p></li>
</ul>
<p>Note: if the skeleton doesn’t exist in the server cache, it may take 20-60 seconds to generate the skeleton before it is returned. This function will block during that time. Any subsequent retrieval of the same skeleton should go very quickly however.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">caveclient</span> <span class="kn">import</span> <span class="n">CAVEclient</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">CAVEclient</span><span class="p">(</span><span class="s2">&quot;minnie65_public&quot;</span><span class="p">)</span>

<span class="c1"># Example: pyramidal cell in v1507</span>
<span class="n">example_cell_id</span> <span class="o">=</span> <span class="mi">864691135572530981</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download as &#39;SWC&#39; fromat</span>

<span class="n">sk_df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">skeleton</span><span class="o">.</span><span class="n">get_skeleton</span><span class="p">(</span><span class="n">example_cell_id</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;swc&#39;</span><span class="p">)</span>

<span class="n">sk_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>type</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th>radius</th>
      <th>parent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>1365.120</td>
      <td>763.456</td>
      <td>812.60</td>
      <td>3.643</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>3</td>
      <td>1368.200</td>
      <td>755.760</td>
      <td>811.24</td>
      <td>0.300</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>3</td>
      <td>1368.200</td>
      <td>758.552</td>
      <td>811.68</td>
      <td>1.915</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>3</td>
      <td>1368.200</td>
      <td>758.560</td>
      <td>812.12</td>
      <td>1.915</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>3</td>
      <td>1368.192</td>
      <td>758.560</td>
      <td>812.44</td>
      <td>2.815</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Skeletons are “tree-like”, where every vertex (except the root vertex) has a single parent that is closer to the root than it, and any number of child vertices. Because of this, for a skeleton there are well-defined directions “away from root” and “towards root” and few types of vertices have special names:</p>
<p>You can see these vertices and edges represented in the alternative <code class="docutils literal notranslate"><span class="pre">dict</span></code> skeleton output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sk_dict</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">skeleton</span><span class="o">.</span><span class="n">get_skeleton</span><span class="p">(</span><span class="n">example_cell_id</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;dict&#39;</span><span class="p">)</span>

<span class="n">sk_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;meta&#39;, &#39;edges&#39;, &#39;mesh_to_skel_map&#39;, &#39;root&#39;, &#39;vertices&#39;, &#39;compartment&#39;, &#39;radius&#39;, &#39;lvl2_ids&#39;])
</pre></div>
</div>
</div>
</div>
<p>Alternately, you can query a set of root_ids, for example all of the <strong>proofread cells</strong> in the dataset, and bulk download the skeletons</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prf_root_ids</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">materialize</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">proofreading_status_and_strategy</span><span class="p">(</span>
    <span class="n">status_axon</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">()[</span><span class="s1">&#39;pt_root_id&#39;</span><span class="p">]</span>
<span class="n">prf_root_ids</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    864691136195824204
1    864691135701896315
2    864691135136188185
Name: pt_root_id, dtype: int64
</pre></div>
</div>
</div>
</div>
<section id="convert-dictionary-to-meshwork-skeleton">
<h3>convert dictionary to meshwork skeleton<a class="headerlink" href="#convert-dictionary-to-meshwork-skeleton" title="Permalink to this heading">#</a></h3>
<p>We use the python package <strong>Meshparty</strong> to convert between mesh representations of neurons, and skeleton representations.</p>
<p>Skeletons are “tree-like”, where every vertex (except the root vertex) has a single parent that is closer to the root than it, and any number of child vertices. Because of this, for a skeleton there are well-defined directions “away from root” and “towards root” and few types of vertices have special names:</p>
<p>Converting the pregenerated skeleton <code class="docutils literal notranslate"><span class="pre">sk_dict</span></code> to a meshwork object <code class="docutils literal notranslate"><span class="pre">sk</span></code> converts the skeleton to a graph object, for convenient representation and analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">meshparty.skeleton</span> <span class="kn">import</span> <span class="n">Skeleton</span>

<span class="n">sk</span> <span class="o">=</span> <span class="n">Skeleton</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">sk_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="plot-with-skeleton-plot">
<h2>Plot with skeleton_plot<a class="headerlink" href="#plot-with-skeleton-plot" title="Permalink to this heading">#</a></h2>
<p>Our convenience package <strong>skeleton_plot</strong> renders the skeleton in aligned, 2D views.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">skeleton_plot</span>
</pre></div>
</div>
<p>Our convenience package <strong>skeleton_plot</strong> renders the skeleton in aligned, 2D views, with the compartments labeled in different colors. Here, <em>dendrite</em> is red, <em>axon</em> is blue, and <em>soma</em> (the root of the connected graph) is olive</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skeleton_plot.plot_tools</span> <span class="kn">import</span> <span class="n">plot_skel</span>

<span class="n">plot_skel</span><span class="p">(</span><span class="n">sk</span><span class="o">=</span><span class="n">sk</span><span class="p">,</span>
          <span class="n">invert_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
          <span class="n">pull_compartment_colors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
          <span class="n">plot_soma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
         <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/60a0250262169a124caf2c0c8be20e18d5cea70f33d6f936ec0b6558a6227ad5.png" src="../../_images/60a0250262169a124caf2c0c8be20e18d5cea70f33d6f936ec0b6558a6227ad5.png" />
</div>
</div>
<p>Skeleton plot is is wrapped around matplotlib, and can be treated as any other subplot. There are arguments to adjust the compartment colors and 2D projection direction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Coronal view</span>
<span class="n">plot_skel</span><span class="p">(</span>
    <span class="n">sk</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Neuron with compartments </span><span class="se">\n</span><span class="s2"> XY View&quot;</span><span class="p">,</span>
    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">plot_soma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">soma_size</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
    <span class="n">invert_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">pull_compartment_colors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
    <span class="n">skel_color_map</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;olive&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;firebrick&quot;</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;salmon&quot;</span><span class="p">,</span> <span class="p">},</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># top down view</span>
<span class="n">plot_skel</span><span class="p">(</span>
    <span class="n">sk</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Neuron with compartments </span><span class="se">\n</span><span class="s2"> XZ View&quot;</span><span class="p">,</span>
    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">plot_soma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">soma_size</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
    <span class="n">invert_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">pull_compartment_colors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">,</span>
    <span class="n">skel_color_map</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;olive&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;firebrick&quot;</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;salmon&quot;</span><span class="p">,</span> <span class="p">},</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">aa</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> 
    <span class="n">aa</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> 
    <span class="n">aa</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> 
    <span class="n">aa</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">aa</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a1fcd10d494195f3a349c1fdc12c10e6c431093d6289f8ac9233e135345f85d9.png" src="../../_images/a1fcd10d494195f3a349c1fdc12c10e6c431093d6289f8ac9233e135345f85d9.png" />
</div>
</div>
</section>
<section id="working-with-meshwork-objects">
<h2>Working with Meshwork Objects<a class="headerlink" href="#working-with-meshwork-objects" title="Permalink to this heading">#</a></h2>
<p>Skeletons are “tree-like”, where every vertex (except the root vertex) has a single parent that is closer to the root than it, and any number of child vertices. Because of this, for a skeleton there are well-defined directions “away from root” and “towards root” and few types of vertices have special names:</p>
<ul class="simple">
<li><p>Branch point: vertices with two or more children, where a neuronal process splits.</p></li>
<li><p>End point: vertices with no children, where a neuronal process ends.</p></li>
<li><p>Root point: The one vertex with no parent node. By convention, we typically set the root vertex at the cell body, so these are equivalent to “away from soma” and “towards soma”.</p></li>
<li><p>Segment: A collection of vertices along an unbranched region, between one branch point and the next end point or branch point downstream.</p></li>
</ul>
<section id="skeleton-properties-and-methods">
<h3>Skeleton Properties and Methods<a class="headerlink" href="#skeleton-properties-and-methods" title="Permalink to this heading">#</a></h3>
<p>To plot this skeleton in a more sophisticated way, you have to start thinking of it as a graph, and the meshwork object has a bunch of tools and properties to help you utilize the skeleton graph.</p>
<p>Let’s list some of the most useful ones below You access each of these with nrn.skeleton.* Use the ? to read more details about each one</p>
<p><strong>Properties</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">branch_points</span></code>: a list of skeleton vertices which are branches</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">root</span></code>: the skeleton vertex which is the soma</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">distance_to_root</span></code>: an array the length of vertices which tells you how far away from the root each vertex is</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">root_position</span></code>: the position of the root node in nanometers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">end_points</span></code>: the tips of the neuron</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cover_paths</span></code>: a list of arrays containing vertex indices that describe individual paths that in total cover the neuron without repeating a vertex. Each path starts at an end point and continues toward root, stopping once it gets to a vertex already listed in a previously defined path. Paths are ordered to start with the end points farthest from root first. Each skeleton vertex appears in exactly one cover path.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">csgraph</span></code>: a scipy.sparse.csr.csr_matrix containing a graph representation of the skeleton. Useful to do more advanced graph operations and algorithms. <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/sparse.csgraph.html">https://docs.scipy.org/doc/scipy/reference/sparse.csgraph.html</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kdtree</span></code>: a scipy.spatial.ckdtree.cKDTree containing the vertices of skeleton as a kdtree. Useful for quickly finding points that are nearby. <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.cKDTree.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.cKDTree.html</a></p></li>
</ul>
<p><strong>Methods</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">path_length(paths=None)</span></code>: the path length of the whole neuron if no arguments, or pass a list of paths to get the path length of that. A path is just a list of vertices which are connected by edges.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">path_to_root(vertex_index)</span></code>: returns the path to the root from the passed vertex</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">path_between(source_index,</span> <span class="pre">target_index)</span></code>: the shortest path between the source vertex index and the target vertex index</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">child_nodes(vertex_indices)</span></code>: a list of arrays listing the children of the vertex indices passed in</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parent_nodes(vertex_indices)</span></code>: an array listing the parent of the vertex indices passed in</p></li>
</ul>
<section id="vertices-and-neighborhoods">
<h4>Vertices and Neighborhoods<a class="headerlink" href="#vertices-and-neighborhoods" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Vertices</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span><span class="si">}</span><span class="s2"> vertices in this neuron&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Branch points</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Branch points are at the following vertices: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">sk</span><span class="o">.</span><span class="n">branch_points</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># End points</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;End points are at the following vertices: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">sk</span><span class="o">.</span><span class="n">end_points</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Root - the point associated with the root node, which is the soma</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Root is vertex: &quot;</span><span class="p">,</span> <span class="n">sk</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Select downstream nodes from one branch point</span>
<span class="n">downstream_nodes</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">downstream_nodes</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">branch_points</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nodes downstream of selected brach are: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">downstream_nodes</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 7445 vertices in this neuron 

Branch points are at the following vertices: 
 [ 253  987 1483 1701 1762 1933 2323 2567 2616 2634 2636 2845 2921 3090
 3252 3280 3381 3413 3446 3603 3625 3630 3631 3683 3711 3783 3821 3848
 3871 3894 3930 3932 3962 4020 4023 4054 4116 4122 4125 4127 4130 4187
 4225 4230 4233 4245 4250 4255 4413 4434 4455 4473 4479 4482 4523 4536
 4629 4762 4800 4830 4831 4832 4933 4934 4963 5060 5077 5104 5118 5123
 5128 5132 5145 5151 5194 5277 5341 5357 5359 5627 5686 5692 5693 5743
 5767 6182 6273 6294 6570 6607 7371 7444] 

End points are at the following vertices: 
 [   0   98  260  268  464  924 1265 1282 1364 1391 1415 1442 1448 1497
 1568 1622 1659 1728 1744 1758 1825 2043 2054 2102 2273 2357 2384 2407
 2533 2534 2565 2617 2665 2703 2756 2768 2823 2850 3062 3102 3175 3275
 3344 3379 3534 3550 3562 3762 3846 3906 3928 4192 4362 4370 4374 4606
 4658 4783 4851 5004 5278 5313 5396 5398 5454 5478 5481 5721 5801 5825
 6330 6335 6413 6461 6725 6776 6829 6836 6890 6945 7041 7098 7109 7137
 7167 7169 7234 7263 7265 7272 7282 7321 7340 7360 7366 7376 7388 7438] 

Root is vertex:  7444 

Nodes downstream of selected brach are: 
 [ 464  468  473  474  475  476  481  482  483  489  490  495  496  502
  503  509  513  514  518  519  520  521  525  526  527  528  529  530
  535  536  542  543  547  548  552  553  559  563  564  565  569  570
  571  572  573  578  579  580  581  586  587  588  589  590  594  595
  596  597  598  599  600  605  606  607  613  614  615  616  620  621
  622  623  624  625  630  631  632  633  634  635  636  637  638  639
  640  641  648  649  650  654  655  656  657  658  659  660  661  662
  663  664  665  670  671  672  673  674  675  676  682  683  688  689
  690  694  700  701  705  706  711  715  716  717  723  724  729  730
  731  732  737  738  739  740  745  746  747  748  753  754  758  759
  765  766  771  772  777  778  782  783  788  789  794  795  799  800
  804  809  810  815  819  820  821  827  828  829  830  831  836  837
  838  839  840  841  846  847  853  854  855  859  860  861  862  867
  868  873  874  875  876  877  881  882  883  884  885  886  890  891
  896  897  902  903  904  911  912  925  926  934  935  936  944  945
  946  947  952  953  954  955  956  957  964  965  966  975  976  990
  991  992 1003 1004 1011 1012 1013 1021 1031 1032 1037 1038 1046 1047
 1051 1056 1057 1062 1063 1068 1069 1076 1077 1078 1079 1083 1084 1091
 1092 1096 1097 1102 1103 1107 1108 1109 1113 1118 1119 1120 1126 1130
 1131 1135 1136 1142 1143 1147 1148 1149 1153 1154 1158 1165 1166 1170
 1171 1176 1180 1181 1186 1190 1191 1192 1196 1197 1202 1203 1204 1205
 1210 1211 1212 1217 1218 1219 1223 1228 1229 1234 1235 1239 1240 1241
 1242 1246 1250 1251 1255 1256 1260 1266 1267 1268 1274 1275 1281 1288
 1299 1307 1308 1316 1323 1325 1334 1342 1343 1351 1352 1360 1371 1372
 1382 1383 1393 1394 1395 1405 1406 1419 1420 1421 1432 1447 1448 1449
 1450 1464 1465 1466 1467 1468 1483 1500 1515 1516 1536 1537 1555 1572
 1573 1595 1596 1616 1639 1640 1672 1673 1696 1697 1698 1699 1700 1701
 1722 1723 1725 1751 1784 1826 1857 1858 1885 1886 1917 1944 1945 1968
 1969 1970 1971 1972 1973 1977 1995 1996 1997 1998 1999 2000 2001 2002
 2005 2007 2024 2026 2030 2032 2033 2035 2037 2065 2066 2067 2068 2072
 2073 2074 2075 2076 2112 2113 2114 2119 2150 2152 2153 2154 2156 2189
 2191 2192 2193 2194 2225 2226 2227 2228 2229 2231 2232 2233 2235 2267
 2268 2269 2270 2305 2306 2307 2308 2309 2310 2311 2351 2352 2393 2394
 2395 2451 2452 2453 2454 2455 2456 2457 2500 2501 2502 2503 2544 2545
 2546 2547 2548 2549 2550 2551 2552 2553 2554 2555 2605 2606 2607 2608
 2609 2610 2611 2612 2613 2614 2615 2616 2617 2618 2665 2667 2669 2670
 2672 2674 2676 2678 2679 2680 2681 2682 2684 2686 2688 2689 2690 2691
 2692 2693 2694 2696 2697 2698 2699 2701] 
</pre></div>
</div>
</div>
</div>
</section>
<section id="paths-and-segments">
<h4>Paths and Segments<a class="headerlink" href="#paths-and-segments" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Segments - path of nodes between two vertices i and j which are assumed to be a root, branch point, or endpoint.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The number of branch segments are: &quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">segments</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Path between - path_between() function finds the vertices on the path between two points on the skeleton graph.</span>
<span class="n">nodes_between</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">path_between</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Path between the given nodes: &quot;</span><span class="p">,</span> <span class="n">nodes_between</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Path-length - path_length() function calculates the physical distance along the path for a neuron</span>
<span class="n">full_pathlength</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">path_length</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1"># Convert to microns</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Path-length of the entire neuron: &quot;</span><span class="p">,</span> <span class="n">full_pathlength</span><span class="p">,</span> <span class="s1">&#39; um&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Path-length for arbitrary segment</span>
<span class="n">example_segment</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">segment_pathlength</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">path_length</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">segments</span><span class="p">[</span><span class="n">example_segment</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1"># Convert to microns </span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Path-length of one segment: &quot;</span><span class="p">,</span> <span class="n">segment_pathlength</span><span class="p">,</span> <span class="s1">&#39; um&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of branch segments are:  190 

Path between the given nodes:  [  0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17
  18  19  20  21  22  23  24  25  26  27  29  28  30  31  32  33  34  35
  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53
  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71
  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89
  90  91  92  93  94  95  96 100 101 103 106 108 109 112 115 117 118 120
 122 124 125 127 128 130 131 133 134 136 139 140 143 145 146 148 150] 

Path-length of the entire neuron:  14846.251  um 

Path-length of one segment:  408.098  um 
</pre></div>
</div>
</div>
</div>
</section>
<section id="masking">
<h4>Masking<a class="headerlink" href="#masking" title="Permalink to this heading">#</a></h4>
<p>One of the most useful methods of the skeleton meshwork’s is the ability to <strong>mask</strong> or select only parts of the skeleton to work with at a time. The function <code class="docutils literal notranslate"><span class="pre">apply_mask()</span></code> acts on the meshwork skeleton, and will apply in place if apply_mask(in_place=True).</p>
<p><em><strong>Warning:</strong></em> be aware when setting a mask in place–mask operations are additive. To reset the mask completely, use <code class="docutils literal notranslate"><span class="pre">reset_mask(in_place=True)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s select a set of nodes from example segment 11</span>
<span class="n">example_segment</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">selected_nodes</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">segments</span><span class="p">[</span><span class="n">example_segment</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Path of the selected nodes is: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">selected_nodes</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># reset to make sure you have the full skeleton</span>
<span class="n">sk</span><span class="o">.</span><span class="n">reset_mask</span><span class="p">(</span><span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Apply a mask to these nodes</span>
<span class="n">sk_masked</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">apply_mask</span><span class="p">(</span><span class="n">selected_nodes</span><span class="p">)</span>

<span class="c1"># Check that this masked skeleton matches the pathlength calculated above</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Path-length of masked segment: &quot;</span><span class="p">,</span> <span class="n">sk_masked</span><span class="o">.</span><span class="n">path_length</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39; um&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Path of the selected nodes is: 
 [1391 1403 1417 1430 1445 1444 1443 1462 1480 1496 1495 1511 1512 1532
 1531 1550 1567 1585 1607 1606 1627 1626 1658 1657 1688 1687 1713 1712
 1742 1774 1773 1813 1812 1842 1840 1872 1871 1903 1902 1934 1957 1956
 1986 2018 2058 2057 2105 2106 2148 2186 2187 2188 2230 2271 2312 2313
 2353 2396 2398 2459 2505 2506 2558 2560 2561 2623 2624 2625 2710 2711
 2712 2777 2778 2713 2714 2779 2781 2835 2837 2838 2909 2911 2976 3038
 3040 3121 3122 3208 3209 3211 3312 3314 3315 3316 3317 3416 3415 3418
 3517 3518 3598 3678 3761 3842 3844 3843 3925 3927 4016 4128 4129 4246
 4248 4354 4472 4469 4639 4641 4638 4817 4821 4820 4973 4974 5072 5168
 5268 5270 5365 5444 5528 5529 5604 5691 5690 5689 5776 5851 5918 5973
 6052 6119 6120 6193 6268 6270 6271 6329 6388 6390 6442 6445 6444 6446
 6498 6550 6551 6499 6501 6503 6553 6554 6597 6644 6645 6689 6743 6782
 6821 6822 6861 6892 6897 6936 6982 6983 6985 6938 6939 6899 6864 6865
 6826 6785 6786 6746 6747 6692 6649 6650 6604 6603 6558 6559 6510 6511
 6454 6396 6397 6398 6343 6285 6286 6212 6213 6140 6068 6069 5990 5991
 5935 5936 5874 5794 5796 5707 5626 5630 5629 5551 5552 5468 5390 5391
 5297 5298] 

Path-length of masked segment:  408.098  um
</pre></div>
</div>
</div>
</div>
<p>Critically, apply_mask() allows us to mask a neuron according to its compartment label: axon, dendrite, soma, etc.</p>
<p><strong>Compartment label conventions</strong> (from standardized swc files <span class="xref myst">www.neuromorpho.org</span> )</p>
<ul class="simple">
<li><p>0 - undefined</p></li>
<li><p>1 - soma</p></li>
<li><p>2 - axon</p></li>
<li><p>3 - (basal) dendrite</p></li>
<li><p>4 - apical dendrite</p></li>
<li><p>5+ - custom</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The unique compartment labels in this skeleton are:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">vertex_properties</span><span class="p">[</span><span class="s1">&#39;compartment&#39;</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Select the indices associated with the dendrites</span>
<span class="n">dendrite_inds</span> <span class="o">=</span> <span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">vertex_properties</span><span class="p">[</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">vertex_properties</span><span class="p">[</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span> <span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">vertex_properties</span><span class="p">[</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#soma is included here to connect the dendrite graphs </span>

<span class="c1"># create new skeleton that masks (selects) only the axon</span>
<span class="n">sk_dendrite</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">apply_mask</span><span class="p">(</span><span class="n">dendrite_inds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dendrite pathlength of all branches is : &quot;</span><span class="p">,</span> <span class="n">sk_dendrite</span><span class="o">.</span><span class="n">path_length</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39; um&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Select the indices associated with the axon, find length</span>
<span class="n">axon_inds</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">vertex_properties</span><span class="p">[</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span>
<span class="n">sk_axon</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">apply_mask</span><span class="p">(</span><span class="n">axon_inds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Axon pathlength is : &quot;</span><span class="p">,</span> <span class="n">sk_axon</span><span class="o">.</span><span class="n">path_length</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39; um&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The unique compartment labels in this skeleton are: [1 2 3] 

Dendrite pathlength of all branches is :  7243.2455  um 

Axon pathlength is :  7599.738  um 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Render all the segments in the dendrite graph</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sk_dendrite</span><span class="o">.</span><span class="n">segments</span><span class="p">)):</span>
    <span class="n">seg</span> <span class="o">=</span> <span class="n">sk_dendrite</span><span class="o">.</span><span class="n">segments</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sk_dendrite</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">seg</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span> 
            <span class="n">sk_dendrite</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">seg</span><span class="p">][:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># add soma marker</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">sk</span><span class="o">.</span><span class="n">root</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
        <span class="n">sk</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">sk</span><span class="o">.</span><span class="n">root</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;oc&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    
<span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1208623.6, 1519800.4, 958991.2, 291440.8)
</pre></div>
</div>
<img alt="../../_images/0be816729c8d74ed95571219fac9a6c5d197c46b5f4d1a4721e2d6e6020502c5.png" src="../../_images/0be816729c8d74ed95571219fac9a6c5d197c46b5f4d1a4721e2d6e6020502c5.png" />
</div>
</div>
</section>
</section>
</section>
<section id="how-em-skeletons-are-generated">
<h2>How EM skeletons are generated<a class="headerlink" href="#how-em-skeletons-are-generated" title="Permalink to this heading">#</a></h2>
<figure class="align-default" id="id4">
<img alt="../../_images/skeleton-cartoon.png" src="../../_images/skeleton-cartoon.png" />
<figcaption>
<p><span class="caption-number">Fig. 40 </span><span class="caption-text">Cartoon illustration of “level 2” graph and skeletons.</span><a class="headerlink" href="#id4" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>In order to understand how these skeletons have been made, you have to understand how large scale EM data is represented. Portions of 3d space are broken up into chunks, such as the grid in the image above. Neurons, such as the cartoon green cell above, span many chunks. Components of the segmentation that live within a single chunk are called level 2 ids, this is because in fact the chunks get iteratively combined into larger chunks, until the chunks span the whole volume. We call this the <a class="reference external" href="https://github.com/CAVEconnectome/PyChunkedGraph">PyChunkedGraph</a> or PCG, after the library which we use to store and interact with this representation. Level 0 is the voxels, level 1 refers to the grouping of voxels within the chunk (also known as supervoxels) and level 2 are the groups of supervoxels within a chunk. A segmentation result can be thought of as a graph at any of these levels, where the voxels, supervoxels, or level 2 ids that are part of the same object are connected. In the above diagram, the PCG level 2 graph is represented as the light red lines.</p>
<p>Such graphs are useful in that they track all the parts of the neuron that are connected to one another, but they aren’t skeletons, because the graph is not directed, and isn’t a simple branching structure.</p>
<p>In order to turn them into a skeleton we have to run an algorithm, that finds a tree like structure that covers the graph and gets close to every node. This is called the TEASAR algorithm and you can read more about how to skeletonize graphs in the <a class="reference external" href="https://meshparty.readthedocs.io/en/latest/guide/skeletons.html#skeletonization">MeshParty documentation</a>.</p>
<p>The result of the algorithm, when applied to a level 2 graph, is a linear tree (like the dotted purple one shown above), where a subset of the level 2 chunks are vertices in that tree, but all the unused level 2 nodes “near” a vertex (red unfilled circles) on the graph are mapped to one of the skeleton vertices (black arrows). This means there are two sets of indices, mesh indices, and skeleton indices, which have a mapping between them (see diagram above).</p>
<p>The MeshParty library allows us to easily store these representations and helps us relate them to each other. A Meshwork object is a data structure that is designed to have three main components that are kept in sync with mesh and skeleton indices:</p>
<ul class="simple">
<li><p>mesh: the graph of PCG level2 ID nodes that are skeletonized, stored as a standard meshparty mesh. Note that this is not the high resolution mesh that you see in neuroglancer. <a class="reference internal" href="em-meshes.html#em-meshes"><span class="std std-ref">See EM Meshes for more</span></a></p></li>
<li><p>skeleton: a meshwork skeleton, derived from the simplification of the mesh</p></li>
<li><p>anno : is a class that holds dataframes and adds some extra info to keep track of indexing.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "allensdk"
        },
        kernelOptions: {
            name: "allensdk",
            path: "./anatomy/microns-em"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'allensdk'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="em-volume-data.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Imagery and Segmentation</p>
      </div>
    </a>
    <a class="right-next"
       href="em-meshes.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Meshes</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-specificity">Dataset specificity</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-precomputed-skeleton">What is a Precomputed skeleton?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#caveclient-to-download-skeletons">CAVEclient to download skeletons</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-dictionary-to-meshwork-skeleton">convert dictionary to meshwork skeleton</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-with-skeleton-plot">Plot with skeleton_plot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-meshwork-objects">Working with Meshwork Objects</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#skeleton-properties-and-methods">Skeleton Properties and Methods</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#vertices-and-neighborhoods">Vertices and Neighborhoods</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#paths-and-segments">Paths and Segments</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#masking">Masking</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-em-skeletons-are-generated">How EM skeletons are generated</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Allen Institute Summer Workshop on the Dynamic Brain
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>